cflags = -Wall
incdir = -I src/
builddir = build

rule cc
  command = clang -std=c11 -MMD -MF $out.d $cflags $incdir -c $in -o $out
  depfile = $out.d
  deps = gcc

rule link
  command = clang $libs $in -o $out

build $builddir/engine.o: cc src/engine.c
build $builddir/test.o: cc src/test.c
build bin/test: link $builddir/test.o $builddir/engine.o
  libs = -lglfw3 -framework Cocoa -framework OpenGL -framework IOKit -framework CoreVideo
